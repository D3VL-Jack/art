<!DOCTYPE html>
<html lang="en">
  <head> 
      <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Spreadsheet Search</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<!-- Inline CSS based on choices in "Settings" tab -->
<style>.bootstrap-iso .form-group button, .bootstrap-iso form input.form-control, .bootstrap-iso form textarea.form-control, .bootstrap-iso form select.form-control, .bootstrap-iso form .form-group-lg input.form-control, .bootstrap-iso form .form-group-lg textarea.form-control, .bootstrap-iso form .form-group-lg select.form-control, .bootstrap-iso form .form-group-sm input.form-control, .bootstrap-iso form .form-group-sm textarea.form-control, .bootstrap-iso form .form-group-sm select.form-control{-webkit-border-radius: 20px;-moz-border-radius: 20px; border-radius: 20px;}.bootstrap-iso .formden_header h2, .bootstrap-iso .formden_header p, .bootstrap-iso form{font-family: Arial, Helvetica, sans-serif; color: black}.bootstrap-iso form button, .bootstrap-iso form button:hover{color: #ffffff !important;}.bootstrap-iso .form-control:focus { border-color: #5bc0de; -webkit-box-shadow: none; box-shadow: none;} .bootstrap-iso .has-error .form-control:focus{-webkit-box-shadow: none; box-shadow: none;} .asteriskField{color: red;}.bootstrap-iso form .input-group-addon {color:#555555; background-color: #eeeeee; border-radius: 20px; padding-left:15px}</style>

  
  </head>
  <body>
    <p id="food"></p>
    <script type="text/javascript">

     var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRDkvQQFQ_7x5bSb2q2eGwxuRJ-Wf50de_Wp1Kbf5F0I_h3M1fAnnLJfGzmP3reraU6SiM0qrKBw1s6/pub?gid=1048722892&single=true&output=csv';
     // var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRB4E_6RnpLP1wWMjqcwsUvotNATB8Np3OntlXb7066ULcAHI9oqqRhucltFifPTYNd7DRNRE56oTdt/pub?output=csv';

      function init() {
        Papa.parse(public_spreadsheet_url, {
          download: true,
          header: true,
          complete: showInfo
        })
      }

      window.addEventListener('DOMContentLoaded', init)

      function showInfo(results) {
        var data = results.data

        // data comes through as a simple array since simpleSheet is turned on
        alert("Successfully processed " + data.length + " rows!")
        document.getElementById("food").innerHTML = "<strong>Example:</strong> " + [ data[0].Name, data[1].Name, data[2].Name ].join(", ");
        console.log(data);
      }

      document.write("The published spreadsheet is located at <a target='_new' href='" + public_spreadsheet_url + "'>" + public_spreadsheet_url + "</a>");        
    </script>
    <p><strong>This example is only going to work if it's on the internet or on a local server!</strong> To run a local server, run "terminal" or "command prompt" and run the command <code>python -m http.server</code> or <code>python -m SimpleHTTPServer</code> (whichever one works, really, and you might even need to <a href="http://littlecolumns.com/tools/python-wrangler/">install Python</a>). Then visit <a href="http://localhost:8000/">http://localhost:8000</a> and you'll be all set.</p>
 

 <div class="container mt-5">
        <h1 class="mb-4">Google Spreadsheet Search</h1>
        <form id="searchForm" class="mb-4">
            <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="Enter keyword">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary">Search</button>
                </div>
            </div>
        </form>
        <div id="loading" class="text-center d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <p>Loading...</p>
        </div>
        <div id="results"></div>
    </div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            var searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            searchGoogleSpreadsheet(searchTerm);
        });

        function searchGoogleSpreadsheet(keyword) {
            var loadingDiv = document.getElementById('loading');
            loadingDiv.classList.remove('d-none');

            Papa.parse(public_spreadsheet_url, {
                download: true,
                header: true,
                complete: function(results) {
                    loadingDiv.classList.add('d-none');
                    displayResults(results.data, keyword);
                }
            });
        }

        function displayResults(data, keyword) {
            var resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            var filteredData = data.filter(function(item) {
                return item.Name.toLowerCase().includes(keyword) || item.Theme.toLowerCase().includes(keyword);
            });

            if (filteredData.length === 0) {
                resultsDiv.innerHTML = '<p class="alert alert-warning">No results found.</p>';
                return;
            }

            filteredData.forEach(function(item) {
                var nameElement = document.createElement('p');
                nameElement.textContent = "Name: " + item.Name;


                var imageElement = document.createElement('img');
                // Fix for cross-origin requests when loading images from Google Drive
                //imageElement.src = 'https://drive.google.com/uc?id=' + extractGoogleDriveFileID(item['Id']);
                imageElement.src = 'https://drive.google.com/thumbnail?id='+ extractGoogleDriveFileID(item['Id'])+'&amp;authuser=0&amp;sz=w200';
                imageElement.classList.add('img-fluid');



                var container = document.createElement('div');
                container.classList.add('border', 'p-3');
                container.appendChild(nameElement);
                container.appendChild(imageElement);

                resultsDiv.appendChild(container);
            });
        }

      function extractGoogleDriveFileID(url) {
            var match = url.match(/\/(?:open|uc)\?id=([^&]+)/);
            return match ? match[1] : url;
        }
    </script>

   
</body>
</html>
    
